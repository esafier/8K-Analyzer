{% extends "base.html" %}
{% block content %}

<h2 class="mb-4">Historical Backfill</h2>
<p class="text-muted">Fetch 8-K filings from a date range in the past. The system will download, filter, and categorize them automatically.</p>

<div class="card" style="max-width: 500px;">
    <div class="card-body">
        <form method="POST" action="/backfill">
            <div class="mb-3">
                <label class="form-label">Start Date</label>
                <input type="date" name="start_date" class="form-control" required>
            </div>
            <div class="mb-3">
                <label class="form-label">End Date</label>
                <input type="date" name="end_date" class="form-control" required>
            </div>
            <div class="mb-3">
                <label class="form-label">AI Model</label>
                <select name="model" class="form-select">
                    <option value="">GPT-4o-mini (default — fast &amp; cheap)</option>
                    <option value="gpt-5.2">GPT-5.2 (premium — better analysis, higher cost)</option>
                </select>
            </div>
            <p class="text-muted small">
                Tip: Start with a small range (1-3 days) to test. Larger ranges will take longer
                since each filing needs to be downloaded and scanned.
            </p>
            <button type="submit" class="btn btn-primary">Start Backfill</button>
        </form>
    </div>
</div>

<hr class="my-5">

<h2 class="mb-4">Refresh Market Caps</h2>
<p class="text-muted">If market caps aren't showing, this clears failed lookups from the cache so they get retried on the next page load.</p>

<div class="card" style="max-width: 500px;">
    <div class="card-body">
        <form method="POST" action="/clear-market-cap-cache">
            <button type="submit" class="btn btn-warning">Refresh Market Caps</button>
        </form>
    </div>
</div>

<hr class="my-5">

<h2 class="mb-4">Clear Database</h2>
<p class="text-muted">Delete all filings so you can re-backfill with the current prompt. Use this after updating the LLM prompt to repopulate with fresh summaries.</p>

<div class="card" style="max-width: 500px;">
    <div class="card-body">
        <form method="POST" action="/clear-database" onsubmit="return confirm('Are you sure? This will delete ALL filings from the database.');">
            <button type="submit" class="btn btn-danger">Clear Database</button>
        </form>
    </div>
</div>

{% endblock %}
